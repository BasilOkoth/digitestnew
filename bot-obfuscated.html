<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Martingale Bot - THREE METHODS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* ADD THESE NEW STYLES */
        .method-selected {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
            border: 2px solid #3b82f6 !important;
        }
        .instant-method { background: linear-gradient(135deg, #10b981, #047857); }
        .smart-method { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .first-tick-method { background: linear-gradient(135deg, #f59e0b, #d97706); }
        
        /* EXISTING STYLES REMAIN SAME */
        #log-area::-webkit-scrollbar { width: 4px; }
        #log-area::-webkit-scrollbar-thumb { background: #4ade80; border-radius: 2px; }
        #log-area::-webkit-scrollbar-track { background: #374151; }
        body { font-family: 'Inter', sans-serif; background-color: #111827; }
        @keyframes pulse-once { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.03); opacity: 0.9; } 100% { transform: scale(1); opacity: 1; } }
        .tick-flash { animation: pulse-once 0.1s ease-out; }
        .queue-indicator { animation: pulse-once 0.3s ease-out; }
        @keyframes win-pulse { 0% { box-shadow: 0 0 5px #10B981; } 50% { box-shadow: 0 0 20px #10B981; } 100% { box-shadow: 0 0 5px #10B981; } }
        .win-detected { animation: win-pulse 0.5s infinite; }
        .queue-digit { 
            width: 32px; 
            height: 32px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            border-radius: 50%; 
            font-weight: bold; 
            margin: 0 2px;
        }
        .contract-type-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        .stop-button-active {
            background-color: #dc2626 !important;
            border: 2px solid #fca5a5 !important;
            animation: pulse-once 0.5s infinite;
        }
        .start-button-active {
            background-color: #16a34a !important;
            border: 2px solid #86efac !important;
            animation: pulse-once 0.5s;
        }
        .token-container {
            position: relative;
        }
        .token-visibility-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 14px;
        }
        .trade-completed {
            border: 3px solid #10b981 !important;
            background-color: #064e3b !important;
        }
        .trade-failed {
            border: 3px solid #ef4444 !important;
            background-color: #7f1d1d !important;
        }
        .tick-current {
            border: 3px solid #10B981 !important;
            background-color: #064e3b !important;
            animation: pulse-once 0.5s infinite;
        }
        .instant-tick {
            animation: pulse-once 0.3s ease-out;
        }
        .success-pulse {
            animation: pulse-once 0.3s ease-out;
        }
        .instant-win-detected {
            animation: pulse-once 0.5s infinite;
            border: 3px solid #00ff00 !important;
            box-shadow: 0 0 20px #00ff00 !important;
        }
        .account-balance-green {
            color: #10B981 !important;
            font-weight: bold !important;
        }
        .current-stake-green {
            color: #10B981 !important;
            font-weight: bold !important;
        }
        .profit-green {
            color: #10B981 !important;
            font-weight: bold !important;
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }
        .profit-red {
            color: #ef4444 !important;
            font-weight: bold !important;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }
        .queued-tick {
            background-color: #1e40af !important;
            border: 2px solid #3b82f6 !important;
        }
        .processing-queued-tick {
            background-color: #7c2d12 !important;
            border: 3px solid #f59e0b !important;
            animation: pulse-once 0.5s infinite;
        }
        .executed-tick {
            background-color: #064e3b !important;
            border: 2px solid #10b981 !important;
        }
        .probability-high { color: #10b981; }
        .probability-medium { color: #f59e0b; }
        .probability-low { color: #ef4444; }
    
        .auto-start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 31, 0.98);
            z-index: 999999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
        .error-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 31, 0.98);
            z-index: 999999;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
            padding: 20px;
        }
        .account-mode-selected {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
            transform: scale(1.05);
        }
        .demo-account { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .real-account { background: linear-gradient(135deg, #10b981, #047857); }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght400;600;700&display=swap" rel="stylesheet">
</head>
<body class="min-h-screen p-4 sm:p-8 flex items-start justify-center">

    <!-- AUTO-START OVERLAY (Shows during auto-authentication) -->
    <div id="autoStartOverlay" class="auto-start-overlay">
        <div class="text-center">
            <div class="w-32 h-32 rounded-3xl bg-gradient-to-r from-green-500 via-blue-500 to-purple-600 flex items-center justify-center mx-auto mb-8 animate-pulse">
                <i class="fas fa-robot text-white text-5xl"></i>
            </div>
            <h2 class="text-4xl font-bold mb-4" style="background: linear-gradient(135deg, #10b981, #3b82f6, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">DigitMatchStars Pro‚Ñ¢</h2>
            <p class="text-xl text-gray-300 mb-8" id="autoStartMessage">Loading trading bot...</p>
            
            <!-- ACCOUNT SELECTION BUTTONS -->
            <div id="accountSelection" class="mb-8 hidden">
                <p class="text-gray-300 mb-4">Select account type:</p>
                <div class="flex gap-4 justify-center">
                    <button onclick="selectAccountMode('DEMO')" class="px-6 py-3 demo-account text-white font-bold rounded-lg hover:opacity-90 transition account-mode-btn">
                        <i class="fas fa-vr-cardboard mr-2"></i> DEMO Account
                    </button>
                    <button onclick="selectAccountMode('REAL')" class="px-6 py-3 real-account text-white font-bold rounded-lg hover:opacity-90 transition account-mode-btn">
                        <i class="fas fa-coins mr-2"></i> REAL Account
                    </button>
                </div>
                <p class="text-gray-400 text-sm mt-3">This selection will be saved for future sessions</p>
            </div>
            
            <div id="loadingSpinner" class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-400 mt-6" id="autoStartSubMessage">Checking authentication...</p>
        </div>
    </div>

    <!-- ERROR OVERLAY (Shows when authentication fails) -->
    <div id="errorOverlay" class="error-overlay">
        <div class="text-center max-w-md">
            <div class="w-24 h-24 rounded-2xl bg-gradient-to-r from-red-500 to-red-700 flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-exclamation-triangle text-white text-4xl"></i>
            </div>
            <h2 class="text-3xl font-bold mb-4 text-red-400">Authentication Required</h2>
            <p class="text-gray-300 mb-6" id="errorMessage">You need to authenticate via OAuth to access the trading bot.</p>
            <div class="space-y-3">
                <a href="index.html" class="inline-block w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-purple-700 text-white font-bold rounded-lg hover:from-purple-700 hover:to-purple-800 transition text-center">
                    <i class="fab fa-deriv mr-2"></i>
                    Connect via OAuth
                </a>
                <button onclick="window.location.reload()" class="w-full px-6 py-3 bg-gray-700 text-white font-bold rounded-lg hover:bg-gray-600 transition">
                    <i class="fas fa-redo mr-2"></i>
                    Retry
                </button>
            </div>
        </div>
    </div>



    <div id="botInterface" style="display:none;" class="w-full max-w-5xl bg-gray-800 text-gray-100 shadow-2xl rounded-xl p-5 md:p-6">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-3xl font-extrabold text-green-400 border-b border-gray-700 pb-2">
                Deriv DigitMatchStar Bot 
                <span id="status-badge" class="ml-3 inline-flex items-center px-3 py-1 text-sm font-medium rounded-full bg-red-600 text-white shadow-md">
                    DMS Disconnected
                </span>
                <span id="contract-type-badge" class="contract-type-badge bg-purple-600 text-white">DIGITMATCH</span>
                <span id="method-badge" class="contract-type-badge bg-blue-600 text-white">METHOD: INSTANT</span>
            </h1>
            <div class="flex items-center space-x-2">
                <!-- ACCOUNT MODE DISPLAY -->
                <div id="accountModeDisplay" class="hidden">
                    <span id="currentAccountMode" class="px-3 py-1 text-sm font-bold rounded-lg"></span>
                </div>
                <button id="soundToggle" onclick="toggleSound()" class="px-4 py-2 bg-blue-600 text-white font-bold rounded-lg shadow hover:bg-blue-700 transition">
                    üîä Sound ON
                </button>
                <button id="logoutButton" onclick="logout()" class="px-4 py-2 bg-gray-700 text-white font-bold rounded-lg shadow hover:bg-gray-600 transition">
                    <i class="fas fa-sign-out-alt mr-1"></i> Logout
                </button>
            </div>
        </div>
        
        <!-- TRADING METHOD SELECTION -->
        <div class="mb-5 p-4 bg-gray-900 rounded-lg border border-green-500/50">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-sm font-bold text-blue-400">üéØ SELECT TRADING METHOD</h3>
                <div class="text-xs text-gray-400">
                    Active: <span id="active-method-name">INSTANT</span>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <button onclick="selectTradingMethod('INSTANT')" id="method-instant" class="method-btn instant-method text-white font-bold py-3 px-4 rounded-lg transition method-selected">
                    <div class="flex items-center justify-center">
                        <i class="fas fa-bolt mr-2"></i>
                        <div class="text-left">
                            <div class="font-bold text-lg">INSTANT</div>
                            <div class="text-xs">Trade on EVERY tick</div>
                            <div class="text-xs opacity-80">Fastest execution</div>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectTradingMethod('SMART')" id="method-smart" class="method-btn smart-method text-white font-bold py-3 px-4 rounded-lg transition">
                    <div class="flex items-center justify-center">
                        <i class="fas fa-brain mr-2"></i>
                        <div class="text-left">
                            <div class="font-bold text-lg">SMART</div>
                            <div class="text-xs">Intelligent prediction</div>
                            <div class="text-xs opacity-80">Based on patterns</div>
                        </div>
                    </div>
                </button>
                
                <button onclick="selectTradingMethod('FIRST_TICK')" id="method-first-tick" class="method-btn first-tick-method text-white font-bold py-3 px-4 rounded-lg transition">
                    <div class="flex items-center justify-center">
                        <i class="fas fa-flag mr-2"></i>
                        <div class="text-left">
                            <div class="font-bold text-lg">FIRST TICK</div>
                            <div class="text-xs">Use first tick digit</div>
                            <div class="text-xs opacity-80">Predict from start</div>
                        </div>
                    </div>
                </button>
            </div>
            
            <!-- Method Description -->
            <div id="method-description" class="mt-3 p-2 bg-gray-800 rounded text-sm">
                <div id="instant-desc" class="method-desc">
                    <span class="font-bold text-green-400">‚ö° INSTANT METHOD:</span> Trades on EVERY tick received. Fastest execution but more trades.
                </div>
                <div id="smart-desc" class="method-desc hidden">
                    <span class="font-bold text-purple-400">üß† SMART METHOD:</span> Analyzes patterns and predicts the most likely digit. Uses AI-like logic.
                </div>
                <div id="first-tick-desc" class="method-desc hidden">
                    <span class="font-bold text-yellow-400">üö© FIRST TICK METHOD:</span> Uses the digit from the very first tick after bot starts as prediction.
                </div>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4 mb-6">
            <div id="controls-section" class="md:w-2/3 grid grid-cols-2 lg:grid-cols-3 gap-3">
                <div>
                    <label for="symbol" class="block text-xs font-semibold text-gray-300 mb-1">Symbol</label>
                    <select id="symbol" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white shadow-sm focus:border-green-500 focus:ring-green-500 py-1.5 px-2 text-sm">
                        <option value="R_10">V. 10 Index</option>
                        <option value="R_100">V. 100 Index</option>
                        <option value="R_25">V. 25 Index</option>
                        <option value="R_50">V. 50 Index</option>
                        <option value="R_75">V. 75 Index</option>
                    </select>
                </div>
                
                <div>
                    <label for="predictedDigit" class="block text-xs font-semibold text-gray-300 mb-1">Predicted Digit (0-9)</label>
                    <input type="number" id="predictedDigit" value="5" min="0" max="9" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white shadow-sm focus:border-green-500 focus:ring-green-500 py-1.5 px-2 text-sm text-center">
                </div>

                <div>
                    <label for="contractType" class="block text-xs font-semibold text-gray-300 mb-1">Contract Type</label>
                    <select id="contractType" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white shadow-sm focus:border-green-500 focus:ring-green-500 py-1.5 px-2 text-sm">
                        <option value="DIGITMATCH">DIGITMATCH (792.9% payout)</option>
                    </select>
                </div>

                <div>
                    <label for="baseStake" class="block text-xs font-semibold text-gray-300 mb-1">Base Stake (USD)</label>
                    <input type="number" id="baseStake" value="1.0" min="0.1" step="0.1" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white shadow-sm focus:border-green-500 focus:ring-green-500 py-1.5 px-2 text-sm">
                </div>

                <div>
                    <label for="multiplier" class="block text-xs font-semibold text-gray-300 mb-1">Martingale Multiplier</label>
                    <input type="number" id="multiplier" value="1.15" min="1.0" step="0.01" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white shadow-sm focus:border-green-500 focus:ring-green-500 py-1.5 px-2 text-sm">
                </div>

                <div>
                    <label for="maxTrades" class="block text-xs font-semibold text-gray-300 mb-1">Max Trades</label>
                    <input type="number" id="maxTrades" value="10" min="1" max="100" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white shadow-sm focus:border-green-500 focus:ring-green-500 py-1.5 px-2 text-sm">
                </div>
                
                <div>
                    <label for="bankrollLimit" class="block text-xs font-semibold text-gray-300 mb-1">Bankroll Limit</label>
                    <input type="number" id="bankrollLimit" value="25.0" min="1.0" step="0.1" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white shadow-sm focus:border-green-500 focus:ring-green-500 py-1.5 px-2 text-sm">
                </div>

                <!-- SMART METHOD SETTINGS -->
                <div id="smart-settings" class="col-span-2 lg:col-span-3 hidden">
                    <div class="bg-gray-700 p-3 rounded-md border border-purple-500/50">
                        <h4 class="text-xs font-bold text-purple-400 mb-2">üß† SMART METHOD SETTINGS</h4>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label for="patternLength" class="block text-xs text-gray-300 mb-1">Pattern Length</label>
                                <input type="number" id="patternLength" value="5" min="2" max="20" class="block w-full rounded-md bg-gray-800 border border-gray-600 text-white py-1 px-2 text-sm">
                            </div>
                            <div>
                                <label for="confidenceThreshold" class="block text-xs text-gray-300 mb-1">Confidence %</label>
                                <input type="number" id="confidenceThreshold" value="60" min="10" max="90" class="block w-full rounded-md bg-gray-800 border border-gray-600 text-white py-1 px-2 text-sm">
                            </div>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">Smart method analyzes recent digit patterns to predict next digit</p>
                    </div>
                </div>

                <!-- FIRST TICK METHOD SETTINGS -->
                <div id="first-tick-settings" class="col-span-2 lg:col-span-3 hidden">
                    <div class="bg-gray-700 p-3 rounded-md border border-yellow-500/50">
                        <h4 class="text-xs font-bold text-yellow-400 mb-2">üö© FIRST TICK METHOD INFO</h4>
                        <p class="text-xs text-gray-300">
                            <span id="first-tick-digit-display" class="font-bold text-yellow-300">?</span> - The bot will use the digit from the very first tick after starting as prediction.
                            No manual digit input needed!
                        </p>
                        <p class="text-xs text-gray-400 mt-1">Current predicted digit will update automatically after bot starts</p>
                    </div>
                </div>
            </div>

            <div id="metrics-column" class="md:w-1/3">
                <div class="grid grid-cols-3 gap-3">
                    <div class="bg-gray-700 rounded-lg p-2 shadow-inner border border-green-500/50 col-span-2">
                        <p class="text-[10px] font-semibold text-green-500 uppercase">Current Tick</p>
                        <p id="metricLiveTick" class="text-xl font-extrabold text-white">---</p>
                        <p id="metricLastDigit" class="text-lg font-bold text-green-300">Digit: ?</p>
                        <p id="metricTickRate" class="text-xs font-bold text-blue-400">Ticks/sec: --</p>
                        <p id="metricProbability" class="text-xs font-bold probability-medium">Method: INSTANT</p>
                    </div>
                    
                    <div class="bg-gray-700 rounded-lg p-2 shadow-inner border border-purple-500/50">
                        <p class="text-[10px] font-semibold text-purple-500 uppercase">Account Balance</p>
                        <p id="metricAccountBalance" class="text-lg font-bold text-white">$---</p>
                        <p class="text-xs text-gray-300 mt-1">Available</p>
                    </div>
                    
                    <div class="bg-gray-700 rounded-lg p-2 shadow-inner">
                        <p class="text-[10px] font-semibold text-green-500 uppercase">Trade #</p>
                        <p id="metricTradeCount" class="text-lg font-bold text-white">0</p>
                    </div>
                    
                    <div class="bg-gray-700 rounded-lg p-2 shadow-inner">
                        <p class="text-[10px] font-semibold text-lime-400 uppercase">Net P/L</p>
                        <p id="metricTotalProfit" class="text-lg font-bold text-gray-300">$0.00</p>
                    </div>
                    
                    <div class="bg-gray-700 rounded-lg p-2 shadow-inner">
                        <p class="text-[10px] font-semibold text-green-500 uppercase">Current Stake</p>
                        <p id="metricCurrentStake" class="text-lg font-bold text-white">$0.00</p>
                    </div>
                    
                    <div id="trade-result-container" class="bg-gray-900 rounded-lg p-3 shadow-inner border border-yellow-500/50 col-span-3">
                        <div class="flex justify-between items-center mb-2">
                            <p class="text-[10px] font-semibold text-yellow-500 uppercase">‚ö° TRADE STATUS</p>
                            <p id="metricTradeResult" class="text-xs font-bold text-gray-400">READY</p>
                        </div>
                        <div class="mb-2">
                            <p class="text-[10px] font-semibold text-gray-400 uppercase mb-1">Status:</p>
                            <p id="metricPreviousResult" class="text-sm font-bold text-gray-300">Select method & start</p>
                        </div>
                        <div>
                            <p class="text-[10px] font-semibold text-gray-400 uppercase mb-1">Method:</p>
                            <p id="metricNextAction" class="text-sm font-bold text-yellow-400">INSTANT</p>
                        </div>
                    </div>
                    
                    <div id="method-status-container" class="bg-gray-900 rounded-lg p-3 shadow-inner border border-blue-500/50 col-span-3 relative">
                        <div class="flex justify-between items-center mb-2">
                            <p class="text-[10px] font-semibold text-blue-500 uppercase">üéØ METHOD STATS</p>
                            <p id="metricMethodStatus" class="text-xs font-bold text-green-400">READY</p>
                        </div>
                        
                        <!-- First Tick Display -->
                        <div id="first-tick-display" class="mb-3 p-2 bg-gray-800 rounded border border-yellow-500/30 hidden">
                            <p class="text-[10px] font-semibold text-yellow-500 uppercase mb-1">First Tick Digit:</p>
                            <div class="flex items-center">
                                <div id="firstTickDigit" class="queue-digit bg-yellow-600 text-white mr-2 text-xl">?</div>
                                <div class="flex-1">
                                    <p id="firstTickInfo" class="text-xs text-gray-300">Waiting for first tick...</p>
                                    <p id="firstTickTime" class="text-[10px] text-gray-400">--</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Smart Analysis Display -->
                        <div id="smart-analysis-display" class="mb-3 p-2 bg-gray-800 rounded border border-purple-500/30 hidden">
                            <p class="text-[10px] font-semibold text-purple-500 uppercase mb-1">Smart Analysis:</p>
                            <div class="flex items-center">
                                <div id="predictedSmartDigit" class="queue-digit bg-purple-600 text-white mr-2 text-xl">?</div>
                                <div class="flex-1">
                                    <p id="smartPredictionInfo" class="text-xs text-gray-300">Analyzing patterns...</p>
                                    <p id="smartConfidence" class="text-[10px] text-gray-400">Confidence: --%</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-2">
                            <div class="flex justify-between items-center mb-1">
                                <p class="text-[10px] font-semibold text-blue-500 uppercase">Trades Executed:</p>
                                <p id="metricExecutedTrades" class="text-xs font-bold text-white">0</p>
                            </div>
                            <div class="w-full bg-gray-700 rounded-full h-2.5 mb-2">
                                <div id="executionBar" class="bg-green-600 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                            <p class="text-[10px] text-gray-400 text-center">Trade progress</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-1 mt-2">
                            <div class="text-center">
                                <p class="text-[8px] text-gray-400 uppercase">Trades Done</p>
                                <p id="metricTradesDone" class="text-xs font-bold text-green-400">0/10</p>
                            </div>
                            <div class="text-center">
                                <p class="text-[8px] text-gray-400 uppercase">Trades Left</p>
                                <p id="metricTradesLeft" class="text-xs font-bold text-blue-400">10</p>
                            </div>
                        </div>
                        <p class="text-[9px] text-gray-400 text-center mt-2">
                            <strong>GOAL:</strong> Win detected within <span id="metricTradesRemaining">10</span> trades
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="flex justify-center mb-5">
            <button id="toggleButton" onclick="toggleBot()" class="w-full md:w-1/2 px-6 py-3 bg-green-600 text-white font-bold text-lg rounded-lg shadow-xl hover:bg-green-700 transition duration-150">
                START BOT
            </button>
        </div>

        <div id="log-column" class="w-full flex flex-col">
            <h2 class="text-lg font-bold text-gray-300 mb-2 border-b border-gray-700 pb-1">Live Trade Log</h2>
            <div id="log-area" class="flex-grow h-80 bg-gray-900 text-lime-400 p-2.5 rounded-lg overflow-y-scroll text-xs whitespace-pre-wrap shadow-inner">
                [00:00:00] ü§ñ Select a trading method and click START...
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <script>
        // ============================================================================
        // AUTHENTICATION SYSTEM (UNCHANGED)
        // ============================================================================
        
        function getSelectedDerivTokenStrict() {
            const selectedMode = localStorage.getItem('selectedAccountMode');
            if (!selectedMode) return null;
            if (selectedMode === 'DEMO') return localStorage.getItem('derivTokenDemo');
            if (selectedMode === 'REAL') return localStorage.getItem('derivTokenReal');
            return null;
        }

        function selectAccountMode(mode) {
            localStorage.setItem('selectedAccountMode', mode);
            let token = null;
            if (mode === 'DEMO') token = localStorage.getItem('derivTokenDemo');
            else if (mode === 'REAL') token = localStorage.getItem('derivTokenReal');
            if (!token) {
                showAuthenticationError(`No ${mode} account token found. Please connect via OAuth using a ${mode} account.`);
                return;
            }
            verifyTokenAndInitialize(token);
        }

        function showAccountSelection() {
            const selectionDiv = document.getElementById('accountSelection');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const message = document.getElementById('autoStartMessage');
            const subMessage = document.getElementById('autoStartSubMessage');
            if (selectionDiv) {
                selectionDiv.style.display = 'block';
                if (loadingSpinner) loadingSpinner.style.display = 'none';
                if (message) message.textContent = 'Select account type:';
                if (subMessage) subMessage.textContent = 'Choose DEMO or REAL account to continue';
                const selectedMode = localStorage.getItem('selectedAccountMode');
                if (selectedMode) {
                    const buttons = document.querySelectorAll('.account-mode-btn');
                    buttons.forEach(btn => {
                        if (btn.textContent.includes(selectedMode)) {
                            btn.classList.add('account-mode-selected');
                        }
                    });
                }
            }
        }

        window.isAuthenticated = false;
        window.authorizedAccount = null;

        document.addEventListener('DOMContentLoaded', () => {
            const hasGenericToken = !!localStorage.getItem('derivToken');
            const hasDemoToken = !!localStorage.getItem('derivTokenDemo');
            const hasRealToken = !!localStorage.getItem('derivTokenReal');
            if (hasGenericToken || hasDemoToken || hasRealToken) {
                showAccountSelection();
                return;
            }
            showAuthenticationError('Authentication required. Please connect via OAuth first.');
        });

        function showAuthenticationError(message) {
            console.log('‚ùå Showing authentication error:', message);
            const overlay = document.getElementById('autoStartOverlay');
            const err = document.getElementById('errorOverlay');
            const errMsg = document.getElementById('errorMessage');
            if (overlay) overlay.style.display = 'none';
            if (errMsg) errMsg.textContent = message || 'Authentication required.';
            if (err) err.style.display = 'flex';
            const bot = document.getElementById('botInterface');
            if (bot) bot.style.display = 'none';
        }

        function verifyTokenAndInitialize(token) {
            if (!token || token.trim() === '') return showAuthenticationError('Invalid token.');
            const msgEl = document.getElementById('autoStartMessage');
            const subEl = document.getElementById('autoStartSubMessage');
            if (msgEl) msgEl.textContent = 'Verifying token...';
            if (subEl) subEl.textContent = 'Authenticating with Deriv...';
            const wsUrls = [
                'wss://ws.derivws.com/websockets/v3?app_id=117144',
                'wss://ws.binaryws.com/websockets/v3?app_id=117144'
            ];
            let wsIndex = 0;
            let testWs = null;
            let verified = false;

            const tryConnect = () => {
                const url = wsUrls[wsIndex++];
                console.log('üîÑ Trying WebSocket endpoint:', url);
                testWs = new WebSocket(url);
                testWs.onopen = () => {
                    try { localStorage.setItem('deriv_ws_url', url); } catch(e) {}
                    testWs.send(JSON.stringify({ authorize: token }));
                };
                testWs.onmessage = (msg) => {
                    try {
                        const data = JSON.parse(msg.data);
                        if (data.error) {
                            console.error('‚ùå Token verification error:', data.error);
                            try { testWs.close(); } catch(e) {}
                            return showAuthenticationError('Authentication failed. Please reconnect via OAuth.');
                        }
                        if (data.msg_type === 'authorize') {
                            const loginid = data.authorize.loginid;
                            const isDemoAccount = loginid.startsWith('VRTC');
                            const selectedMode = localStorage.getItem('selectedAccountMode');
                            if (!selectedMode) {
                                try { testWs.close(); } catch(e) {}
                                showAuthenticationError('Please select DEMO or REAL before trading.');
                                return;
                            }
                            if ((selectedMode === 'DEMO' && !isDemoAccount) || (selectedMode === 'REAL' && isDemoAccount)) {
                                try { testWs.close(); } catch(e) {}
                                showAuthenticationError('Account type mismatch. Please select the correct DEMO or REAL account.');
                                return;
                            }
                            verified = true;
                            window.isAuthenticated = true;
                            window.authorizedAccount = data.authorize || null;
                            window.DERIV_TOKEN = getSelectedDerivTokenStrict();
                            try { localStorage.setItem('derivAccount', data.authorize?.loginid || ''); } catch(e) {}
                            try { testWs.close(); } catch(e) {}
                            initializeBotAfterAuth();
                        }
                    } catch (e) { console.error('Token verification parse error', e); }
                };
                testWs.onerror = () => {
                    console.error('WebSocket error during token verification on', url);
                    if (wsIndex < wsUrls.length) {
                        try { testWs.close(); } catch(e) {}
                        tryConnect();
                    } else {
                        showAuthenticationError('Connection error. Please check your internet.');
                    }
                };
                setTimeout(() => {
                    if (verified) return;
                    if (testWs && testWs.readyState === WebSocket.OPEN) {
                        try { testWs.close(); } catch(e) {}
                    }
                    if (wsIndex < wsUrls.length) {
                        tryConnect();
                    } else {
                        showAuthenticationError('Connection timeout. Please try again.');
                    }
                }, 15000);
            };
            tryConnect();
        }

        function initializeBotAfterAuth() {
            const overlay = document.getElementById('autoStartOverlay');
            const err = document.getElementById('errorOverlay');
            const bot = document.getElementById('botInterface');
            if (overlay) overlay.style.display = 'none';
            if (err) err.style.display = 'none';
            if (bot) bot.style.display = 'block';
            const selectedMode = localStorage.getItem('selectedAccountMode');
            if (selectedMode) {
                const modeDisplay = document.getElementById('accountModeDisplay');
                const currentModeSpan = document.getElementById('currentAccountMode');
                if (modeDisplay && currentModeSpan) {
                    modeDisplay.style.display = 'block';
                    currentModeSpan.textContent = selectedMode === 'DEMO' ? 'üìä DEMO' : 'üí∞ REAL';
                    currentModeSpan.className = selectedMode === 'DEMO' 
                        ? 'px-3 py-1 text-sm font-bold rounded-lg demo-account text-white'
                        : 'px-3 py-1 text-sm font-bold rounded-lg real-account text-white';
                }
            }
            try { initializeBot(); } catch (e) { console.error(e); }
        }

        function logout() {
            try { if (window.isBotRunning) stopBot(); } catch(e) {}
            localStorage.removeItem('derivToken');
            localStorage.removeItem('derivTokenDemo');
            localStorage.removeItem('derivTokenReal');
            localStorage.removeItem('selectedAccountMode');
            localStorage.removeItem('auth_method');
            localStorage.removeItem('last_auth_time');
            localStorage.removeItem('auto_open_bot');
            sessionStorage.clear();
            window.DERIV_TOKEN = '';
            window.isAuthenticated = false;
            showAuthenticationError('Logged out. Please connect via OAuth again.');
            setTimeout(() => { window.location.href = 'index.html'; }, 800);
        }

        // ============================================================================
        // NEW: TRADING METHOD LOGIC
        // ============================================================================
        
        // ADD THESE VARIABLES TO GLOBAL STATE
        window.selectedMethod = 'INSTANT'; // INSTANT, SMART, or FIRST_TICK
        window.firstTickDigit = null;
        window.firstTickReceived = false;
        window.firstTickPrice = null;
        window.firstTickTime = null;
        window.smartPrediction = null;
        window.smartConfidence = 0;

        // TRADING METHOD SELECTION FUNCTION
        function selectTradingMethod(method) {
            window.selectedMethod = method;
            document.querySelectorAll('.method-btn').forEach(btn => {
                btn.classList.remove('method-selected');
            });
            document.getElementById(`method-${method.toLowerCase()}`).classList.add('method-selected');
            document.getElementById('method-badge').textContent = `METHOD: ${method.replace('_', ' ')}`;
            document.getElementById('active-method-name').textContent = method.replace('_', ' ');
            document.getElementById('metricNextAction').textContent = method.replace('_', ' ');
            document.getElementById('smart-settings').classList.add('hidden');
            document.getElementById('first-tick-settings').classList.add('hidden');
            document.querySelectorAll('.method-desc').forEach(desc => {
                desc.classList.add('hidden');
            });
            document.getElementById(`${method.toLowerCase().replace('_', '-')}-desc`).classList.remove('hidden');
            document.getElementById('first-tick-display').classList.add('hidden');
            document.getElementById('smart-analysis-display').classList.add('hidden');
            
            if (method === 'FIRST_TICK') {
                document.getElementById('predictedDigit').disabled = true;
                document.getElementById('predictedDigit').classList.add('opacity-50', 'cursor-not-allowed');
                document.getElementById('predictedDigit').value = '?';
                document.getElementById('first-tick-settings').classList.remove('hidden');
                document.getElementById('first-tick-display').classList.remove('hidden');
                log(`üéØ Method selected: FIRST TICK - Will use digit from first tick as prediction`, 'METHOD');
            } else if (method === 'SMART') {
                document.getElementById('predictedDigit').disabled = false;
                document.getElementById('predictedDigit').classList.remove('opacity-50', 'cursor-not-allowed');
                document.getElementById('predictedDigit').value = '?';
                document.getElementById('smart-settings').classList.remove('hidden');
                document.getElementById('smart-analysis-display').classList.remove('hidden');
                log(`üéØ Method selected: SMART - Analyzing patterns for intelligent prediction`, 'METHOD');
            } else {
                document.getElementById('predictedDigit').disabled = false;
                document.getElementById('predictedDigit').classList.remove('opacity-50', 'cursor-not-allowed');
                document.getElementById('predictedDigit').value = '5';
                log(`üéØ Method selected: INSTANT - Trading on every tick`, 'METHOD');
            }
            updateProbability();
        }

        // SMART PREDICTION FUNCTION
        function smartPredictDigit() {
            if (window.digitsHistory.length < 5) {
                window.smartPrediction = null;
                window.smartConfidence = 0;
                return;
            }
            const patternLength = parseInt(document.getElementById('patternLength').value) || 5;
            const history = window.digitsHistory.slice(-patternLength);
            const freq = new Array(10).fill(0);
            history.forEach(d => { freq[d]++; });
            let maxFreq = 0;
            let predictedDigit = null;
            for (let i = 0; i < 10; i++) {
                if (freq[i] > maxFreq) {
                    maxFreq = freq[i];
                    predictedDigit = i;
                }
            }
            const confidence = Math.round((maxFreq / history.length) * 100);
            const threshold = parseInt(document.getElementById('confidenceThreshold').value) || 60;
            if (confidence >= threshold) {
                window.smartPrediction = predictedDigit;
                window.smartConfidence = confidence;
                document.getElementById('predictedSmartDigit').textContent = predictedDigit;
                document.getElementById('smartPredictionInfo').textContent = `Predicted: ${predictedDigit}`;
                document.getElementById('smartConfidence').textContent = `Confidence: ${confidence}%`;
                document.getElementById('smartConfidence').className = confidence >= 70 ? 
                    'text-[10px] text-green-400' : 
                    confidence >= 50 ? 'text-[10px] text-yellow-400' : 'text-[10px] text-red-400';
                if (document.getElementById('predictedDigit').value === '?') {
                    document.getElementById('predictedDigit').value = predictedDigit;
                }
                return predictedDigit;
            } else {
                window.smartPrediction = null;
                window.smartConfidence = confidence;
                document.getElementById('predictedSmartDigit').textContent = '?';
                document.getElementById('smartPredictionInfo').textContent = `Analyzing...`;
                document.getElementById('smartConfidence').textContent = `Confidence: ${confidence}%`;
                return null;
            }
        }

        // FIRST TICK PROCESSING
        function processFirstTick(tick) {
            if (window.firstTickReceived) return;
            const digit = parseInt(tick.digit);
            window.firstTickDigit = digit;
            window.firstTickPrice = tick.price;
            window.firstTickTime = tick.time;
            window.firstTickReceived = true;
            document.getElementById('firstTickDigit').textContent = digit;
            document.getElementById('firstTickInfo').textContent = `Price: ${tick.price.toFixed(3)}`;
            document.getElementById('firstTickTime').textContent = new Date(tick.time).toLocaleTimeString();
            document.getElementById('firstTickDigit').classList.add('instant-tick');
            document.getElementById('predictedDigit').value = digit;
            document.getElementById('first-tick-digit-display').textContent = digit;
            log(`üö© FIRST TICK CAPTURED: Digit ${digit} from price ${tick.price.toFixed(3)}`, 'FIRST_TICK');
            log(`üéØ PREDICTION SET: Will trade on digit ${digit}`, 'FIRST_TICK');
            playAudioFeedback('WIN');
        }

        // ============================================================================
        // MODIFIED: TICK PROCESSING FOR THREE METHODS
        // ============================================================================
        
        // REPLACE THE checkForImmediateWin FUNCTION with this:
        function checkForImmediateWin(tick) {
            if (!window.isBotRunning || window.stopAfterWin) return false;
            
            let predictedDigit;
            if (window.selectedMethod === 'FIRST_TICK') {
                if (!window.firstTickDigit) return false;
                predictedDigit = window.firstTickDigit;
            } else if (window.selectedMethod === 'SMART') {
                if (!window.smartPrediction) return false;
                predictedDigit = window.smartPrediction;
            } else {
                predictedDigit = parseInt(document.getElementById('predictedDigit').value);
            }
            
            const tickDigit = parseInt(tick.digit);
            
            if (tickDigit === predictedDigit) {
                log(`üéØ WIN DETECTED! Tick digit ${tickDigit} matches predicted ${predictedDigit}.`, 'IMMEDIATE_WIN');
                log(`‚úÖ ${window.selectedMethod} METHOD SUCCESSFUL in ${window.tradeCount + 1} trades`, 'STRATEGY');
                
                // Mark as win immediately
                window.lastTradeResult = 'win';
                window.stopAfterWin = true;
                window.stats.wins++;
                window.stats.digitMatches++;
                window.tradeCount++;
                
                // Visual feedback
                const processingDigit = document.getElementById('processingTickDigit');
                processingDigit.textContent = tickDigit;
                processingDigit.classList.add('instant-win-detected');
                
                const tradeResultContainer = document.getElementById('trade-result-container');
                tradeResultContainer.classList.add('trade-completed');
                
                playAudioFeedback('INSTANT_WIN');
                
                // Update trade result status
                updateTradeResultStatus();
                
                // We won't update PnL here - wait for actual balance update
                log(`üìä Waiting for balance update to calculate actual PnL...`, 'INFO');
                
                return true;
            }
            
            window.stats.digitNonMatches++;
            return false;
        }

        // MODIFY THE executeTrade FUNCTION to handle different methods:
        function executeTrade(tick) {
            const contractType = document.getElementById('contractType').value;
            let predictedDigit;
            
            if (window.selectedMethod === 'FIRST_TICK') {
                predictedDigit = window.firstTickDigit;
            } else if (window.selectedMethod === 'SMART') {
                predictedDigit = window.smartPrediction;
            } else {
                predictedDigit = parseInt(document.getElementById('predictedDigit').value);
            }
            
            if (predictedDigit === null || predictedDigit === undefined) {
                log(`‚ùå No prediction available for ${window.selectedMethod} method`, 'ERROR');
                onTradeComplete(false);
                return;
            }
            
            const symbol = document.getElementById('symbol').value;
            const stake = window.currentStake;

            // Use duration 1 for fastest possible resolution
            const duration = 1;
            
            const proposalRequest = {
                proposal: 1,
                amount: stake.toFixed(2),
                basis: "stake",
                contract_type: contractType,
                currency: "USD",
                duration: duration,
                duration_unit: "t",
                symbol: symbol,
                barrier: predictedDigit.toString(),
                req_id: getNextReqId()
            };

            log(`üìä Trade #${window.tradeCount}: $${stake.toFixed(2)} on digit ${predictedDigit} (${window.selectedMethod})`, 'TRADE');
            
            // Store pending proposal
            window.pendingProposals.set(proposalRequest.req_id, {
                tick: tick,
                stake: stake,
                contractType: contractType,
                predictedDigit: predictedDigit,
                startTime: Date.now()
            });
            
            // Send request
            sendRequest(proposalRequest);
        }

        // MODIFY THE handleTick FUNCTION:
        function handleTick(tick) {
            if (!window.isBotRunning) return;
            
            const price = parseFloat(tick.quote);
            
            // FIXED: Use the CORRECTED digit extraction function
            // Always use 3 decimal places for display consistency
            const digit = extractLastDigitBySymbol(price);
            
            const time = parseInt(tick.epoch) * 1000;
            const tickData = { digit: digit, price: price, time: time };
            
            // Store tick data
            window.lastTick = tickData;
            
            // Update live tick display - always show 3 decimal places for consistency
            const displayPrice = price.toFixed(3);
            document.getElementById('metricLiveTick').textContent = displayPrice;
            document.getElementById('metricLastDigit').textContent = `Digit: ${digit}`;
            document.getElementById('metricLiveTick').classList.add('tick-flash');
            setTimeout(() => document.getElementById('metricLiveTick').classList.remove('tick-flash'), 50);
            
            window.tickTimestamps.push(Date.now());
            window.stats.totalTicks++;
            
            // Add to history for probability calculation
            window.digitsHistory.push(parseInt(tickData.digit));
            if (window.digitsHistory.length > window.MAX_HISTORY) {
                window.digitsHistory.shift();
            }
            
            // Handle first tick method
            if (window.selectedMethod === 'FIRST_TICK' && !window.firstTickReceived) {
                processFirstTick(tickData);
            }
            
            // Run smart prediction if needed
            if (window.selectedMethod === 'SMART') {
                smartPredictDigit();
            }
            
            // Add tick to queue (for instant method)
            addTickToQueue(tickData);
            
            playAudioFeedback('TICK');
            
            // Log first few ticks with debug info
            if (window.stats.totalTicks <= 5) {
                const symbol = document.getElementById('symbol').value;
                log(`üéØ Tick ${window.stats.totalTicks}: ${displayPrice} (Digit ${digit}) Symbol: ${symbol}`, 'TICK');
            }
        }

        // MODIFY THE processTickImmediately FUNCTION:
        function processTickImmediately(tick) {
            if (window.stopAfterWin) return;
            
            // Check for win first
            if (checkForImmediateWin(tick)) {
                return;
            }
            
            // Check if we should trade based on method
            if (window.selectedMethod === 'SMART' && !window.smartPrediction) {
                return; // Don't trade if smart method has no prediction
            }
            
            if (window.selectedMethod === 'FIRST_TICK' && !window.firstTickDigit) {
                return; // Don't trade if first tick not captured
            }
            
            // Check max trades
            if (window.tradeCount >= window.maxTrades) {
                log(`üõë Max trades limit reached (${window.maxTrades})`, 'CRITICAL');
                stopBot();
                return;
            }
            
            // Execute trade
            window.executionLock = true;
            window.nextTradeAllowed = false;
            
            try {
                window.stats.tradesExecuted++;
                window.tradeCount++;
                document.getElementById('metricTradeCount').textContent = window.tradeCount;
                
                log(`‚ö° TRADE #${window.tradeCount}: ${tick.price.toFixed(3)} (Digit ${tick.digit})`, 'INSTANT');
                playAudioFeedback('EXECUTION');
                
                // Update display
                updateProcessingTickDisplay(tick);
                
                // Execute trade immediately
                executeTrade(tick);
                
            } catch (error) {
                log(`‚ùå Error in processTickImmediately: ${error}`, 'ERROR');
                window.executionLock = false;
                window.nextTradeAllowed = true;
            }
        }

        // MODIFY THE initializeBot FUNCTION:
        function initializeBot() {
            console.log('ü§ñ Bot page loaded successfully');
            
            // Load saved settings
            window.soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
            updateSoundButton();
            
            // Initialize displays
            updateContractTypeDisplay();
            
            window.baseStake = parseFloat(document.getElementById('baseStake').value) || 1.0;
            window.currentStake = window.baseStake;
            document.getElementById('metricCurrentStake').textContent = `$${window.currentStake.toFixed(2)}`;
            
            // Set up event listeners
            contractTypeSelect.addEventListener('change', updateContractTypeDisplay);
            
            // Start periodic updates
            setInterval(calculateRates, 1000);
            setInterval(updateStrategyDisplay, 100);
            setInterval(updateProbability, 2000);
            
            // Start smart prediction processor
            setInterval(() => {
                if (window.selectedMethod === 'SMART' && window.isBotRunning) {
                    smartPredictDigit();
                }
            }, 1000);
            
            log('ü§ñ Bot initialized with THREE trading methods:', 'SYSTEM');
            log('1. ‚ö° INSTANT: Trade on EVERY tick', 'SYSTEM');
            log('2. üß† SMART: Intelligent pattern-based prediction', 'SYSTEM');
            log('3. üö© FIRST TICK: Use first tick digit as prediction', 'SYSTEM');
            
            // Start queue processor
            startQueueProcessor();
        }

        // MODIFY THE updateProbability FUNCTION:
        function updateProbability() {
            const probabilityElem = document.getElementById('metricProbability');
            
            if (window.selectedMethod === 'INSTANT') {
                if (!window.isBotRunning || window.digitsHistory.length < 10) {
                    probabilityElem.textContent = 'Method: INSTANT';
                    probabilityElem.className = 'text-xs font-bold probability-medium';
                    return;
                }
                
                const predictedDigit = parseInt(document.getElementById('predictedDigit').value);
                const frequency = window.digitsHistory.filter(d => d === predictedDigit).length;
                const probability = (frequency / window.digitsHistory.length) * 100;
                probabilityElem.textContent = `Probability: ${probability.toFixed(1)}%`;
                
                if (probability > 15) probabilityElem.className = 'text-xs font-bold probability-high';
                else if (probability > 8) probabilityElem.className = 'text-xs font-bold probability-medium';
                else probabilityElem.className = 'text-xs font-bold probability-low';
                
            } else if (window.selectedMethod === 'SMART') {
                if (window.smartConfidence > 0) {
                    probabilityElem.textContent = `Smart: ${window.smartConfidence}% confidence`;
                    if (window.smartConfidence >= 70) probabilityElem.className = 'text-xs font-bold probability-high';
                    else if (window.smartConfidence >= 50) probabilityElem.className = 'text-xs font-bold probability-medium';
                    else probabilityElem.className = 'text-xs font-bold probability-low';
                } else {
                    probabilityElem.textContent = 'Smart: Analyzing...';
                    probabilityElem.className = 'text-xs font-bold probability-medium';
                }
            } else if (window.selectedMethod === 'FIRST_TICK') {
                if (window.firstTickDigit !== null) {
                    probabilityElem.textContent = `First Tick: Digit ${window.firstTickDigit}`;
                    probabilityElem.className = 'text-xs font-bold probability-high';
                } else {
                    probabilityElem.textContent = 'First Tick: Waiting...';
                    probabilityElem.className = 'text-xs font-bold probability-medium';
                }
            }
        }

        // MODIFY THE resetAllState FUNCTION:
        function resetAllState() {
            // Reset method-specific state
            window.firstTickDigit = null;
            window.firstTickReceived = false;
            window.firstTickPrice = null;
            window.firstTickTime = null;
            window.smartPrediction = null;
            window.smartConfidence = 0;
            
            updateStake('initial');
            
            // Reset PnL data
            window.startingBalance = 0.0;
            window.currentBalance = 0.0;
            window.netProfit = 0.0;
            window.lastBalanceUpdate = 0;
            
            const profitElem = document.getElementById('metricTotalProfit');
            profitElem.textContent = '$0.00';
            profitElem.className = 'text-lg font-bold text-gray-300';
            
            document.getElementById('metricTradeCount').textContent = '0';
            
            const balanceElem = document.getElementById('metricAccountBalance');
            balanceElem.textContent = '$---';
            balanceElem.className = 'text-lg font-bold text-white';
            
            document.getElementById('metricLiveTick').textContent = '---';
            document.getElementById('metricLastDigit').textContent = 'Digit: ?';
            
            window.stats = {
                totalTicks: 0,
                tradesExecuted: 0,
                wins: 0,
                losses: 0,
                digitMatches: 0,
                digitNonMatches: 0
            };
            
            // Clear queue and history
            window.tickQueue = [];
            window.digitsHistory = [];
            updateQueueDisplay();
            
            window.lastTick = null;
            window.lastTradeResult = null;
            window.tradeCount = 0;
            window.martingaleStep = 0;
            window.pendingProposals.clear();
            window.activeContracts.clear();
            window.tickTimestamps = [];
            window.lastTenDigits = [];
            
            // Reset execution state
            window.executionLock = false;
            window.waitingForTradeResult = false;
            window.nextTradeAllowed = true;
            window.stopAfterWin = false;
            window.currentlyProcessingTick = null;
            
            const logArea = document.getElementById('log-area');
            logArea.innerHTML = `[00:00:00] ü§ñ Starting ${window.selectedMethod} method...`;
            
            updateTradeResultStatus();
            updateStrategyDisplay();
            
            log(`üîÑ ALL STATE RESET: Starting ${window.selectedMethod} method`, 'SYSTEM');
        }

        // ADD THIS FUNCTION TO UPDATE LOG COLORS:
        function log(message, type = 'INFO') {
            const logArea = document.getElementById('log-area');
            const timestamp = new Date().toLocaleTimeString('en-US', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                fractionalSecondDigits: 3 
            });
            
            let color = 'text-lime-400';
            if (type === 'ERROR') color = 'text-red-500 font-bold'; 
            if (type === 'WARNING') color = 'text-yellow-400';
            if (type === 'TRADE') color = 'text-green-300';
            if (type === 'WIN') color = 'text-green-400 font-bold';
            if (type === 'LOSS') color = 'text-red-400 font-bold';
            if (type === 'QUEUE') color = 'text-blue-400';
            if (type === 'TICK') color = 'text-cyan-300';
            if (type === 'MARTINGALE') color = 'text-purple-400';
            if (type === 'CONTRACT') color = 'text-pink-400';
            if (type === 'REAL_TRADE') color = 'text-yellow-300 font-bold';
            if (type === 'CRITICAL') color = 'text-red-400 font-bold';
            if (type === 'SYSTEM') color = 'text-white';
            if (type === 'STRATEGY') color = 'text-green-300 font-bold';
            if (type === 'INSTANT') color = 'text-green-400 font-bold';
            if (type === 'PNL') color = 'text-yellow-300 font-bold';
            if (type === 'METHOD') color = 'text-blue-300 font-bold';
            if (type === 'SMART') color = 'text-purple-300 font-bold';
            if (type === 'FIRST_TICK') color = 'text-yellow-300 font-bold';
            
            logArea.innerHTML += `\n[${timestamp}] <span class="${color}">${message}</span>`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        // ============================================================================
        // EXISTING FUNCTIONS THAT DON'T NEED CHANGES (keep them as they are)
        // ============================================================================
        
        // The rest of your existing functions remain exactly the same:
        // - extractLastDigitBySymbol
        // - startQueueProcessor
        // - updateQueueDisplay
        // - addTickToQueue
        // - updatePnL
        // - onTradeComplete
        // - updateContractTypeDisplay
        // - calculateRates
        // - toggleSound
        // - updateSoundButton
        // - initTone
        // - playAudioFeedback
        // - updateButtonState
        // - updateTradeResultStatus
        // - updateStake
        // - connectWebSocket
        // - startWebSocketKeepAlive
        // - stopWebSocketKeepAlive
        // - sendRequest
        // - getNextReqId
        // - handleAPIResponse
        // - subscribeToBalance
        // - handleBalanceUpdate
        // - handleContractUpdate
        // - subscribeToTicks
        // - handleProposalResponse
        // - executeBuy
        // - handleBuyResponse
        // - showNotification
        // - toggleBot
        // - startBot
        // - stopBot
        
        // Add this line at the end of your existing code to initialize the method selection:
        setTimeout(() => {
            if (document.getElementById('botInterface').style.display !== 'none') {
                selectTradingMethod('INSTANT');
            }
        }, 100);

    </script>
</body>
</html>
